{"version":3,"sources":["components/common/registerlayout/Register.js","components/common/registerlayout/index.js","managers/AuthService.js"],"names":["Register","props","Auth","AuthService","dispatch","useDispatch","useState","setValue","selectedValue","setSelectedValue","value","isValid","phone","setPhone","cid","setCid","handleSubmit","e","preventDefault","isGood","length","formIsValidSearch","data_token","id","name","label","data","userid","Promise","resolve","reject","createRegisterMsg","a","createRegister","then","res","msg","setToken","setTimeout","window","location","replace","status","Swal","fire","icon","title","text","showConfirmButton","timer","catch","useEffect","className","to","onSubmit","cacheOptions","defaultOptions","getOptionLabel","getOptionValue","loadOptions","inputValue","callback","showUser","response","workers","error","map","badgenumber","onInputChange","onChange","placeholder","theme","colors","neutral50","mask","maskChar","target","type","disabled","style","marginTop","packageJson","version","this","getToken","jwt","sign","localStorage","setItem","getItem","decode"],"mappings":"oQAmReA,MArQf,SAAkBC,GAChB,IAAMC,EAAO,IAAIC,IAAY,0BACvBC,EAAWC,cAFM,EAGQC,mBAAS,IAHjB,mBAGJC,GAHI,aAImBD,mBAAS,MAJ5B,mBAIhBE,EAJgB,KAIDC,EAJC,OAKGH,mBAAS,CAAEI,MAAO,GAAIC,SAAS,IALlC,mBAKhBC,EALgB,KAKTC,EALS,OAMDP,mBAAS,CAAEI,MAAO,GAAIC,SAAS,IAN9B,mBAMhBG,EANgB,KAMXC,EANW,KAgEjBC,EAAe,SAACC,GAEpB,GADAA,EAAEC,iBAzBsB,WACxB,IAAIC,GAAS,EAoBb,OAlBIP,EAAMF,MAAMU,OAAS,KACvBR,EAAMD,SAAU,EAChBQ,GAAS,GAGPL,EAAIJ,MAAMU,OAAS,KACrBN,EAAIH,SAAU,EACdQ,GAAS,GAGNA,IACHN,EAAS,eACJD,IAELG,EAAO,eACFD,KAGAK,EAKHE,GAAqB,CACvB,IAAMC,EAAa,CACjBC,GAAIf,EAAcE,MAClBc,KAAMhB,EAAciB,MACpBb,MAAOA,EAAMF,OAGTgB,EAAO,CACXC,OAAQnB,EAAcE,MACtBc,KAAMhB,EAAciB,MACpBb,MAAOA,EAAMF,MACbI,IAAKA,EAAIJ,OAGE,IAAIkB,SAAQ,SAAUC,EAASC,GAAS,SACpCC,IADmC,2EAClD,sBAAAC,EAAA,sEACe5B,EAAS6B,YAAeP,IAAOQ,MAAK,SAACC,GAChD,OAAOA,EAAI,GAAGC,OAFlB,oFADkD,sBAOlD,sBAAC,sBAAAJ,EAAA,sEACyBD,IADzB,OAGqB,uBAHrB,QAIG7B,EAAKmC,SAASf,GACdgB,YAAW,WACTC,OAAOC,SAASC,QAAQ,iCACvB,MACHZ,GAAQ,IAERC,GAAO,GAVV,0CAAD,MAgBKI,MAAK,SAACQ,GACXA,EACIC,IAAKC,KAAK,CAERC,KAAM,UACNC,MAAO,uCACPC,KAAM,uLACNC,mBAAmB,EACnBC,MAAO,OAETN,IAAKC,KAAK,CAERC,KAAM,UACNC,MAAO,6CACPC,KAAM,mGACNC,mBAAmB,EACnBC,MAAO,UAEZC,OAAM,SAACjC,GACR0B,IAAKC,KAAK,CAERC,KAAM,QACNC,MAAO,6CACPC,KAAM,mGACNC,mBAAmB,EACnBC,MAAO,YAQf,OAFAE,qBAAU,cAAU,CAAC/C,IAGnB,yBAAKgD,UAAU,8BACb,yBAAKA,UAAU,aACb,yBAAKA,UAAU,cACb,kBAAC,IAAD,CAAMC,GAAG,SAASZ,SAAO,GACvB,6CADF,qDAIF,yBAAKW,UAAU,QACb,yBAAKA,UAAU,6BACb,uBAAGA,UAAU,iBAAb,4HACA,0BAAMA,UAAU,OAAOE,SAAU,SAACrC,GAAD,OAAOD,EAAaC,KACnD,yBAAKmC,UAAU,cACb,yBAAKA,UAAU,OACb,yBAAKA,UAAU,UACb,kBAAC,IAAD,CACEG,cAAY,EACZC,gBAAc,EACd9C,MAAOF,EACPiD,eAAgB,SAACxC,GAAD,OAAOA,EAAEQ,OACzBiC,eAAgB,SAACzC,GAAD,OAAOA,EAAEP,OACzBiD,YA1IA,SAACC,EAAYC,GAC/B,KAAkB,MAAdD,GAAsBA,EAAWxC,OAAS,GAO9C,OAAOhB,EAAS0D,YAASF,IAAa1B,MAAK,SAAC6B,GAC1C,IAAIC,EAAU,GACVD,IAAaA,EAASE,OACxBF,EAASG,KAAI,SAAC/B,GACZ,OAAQ6B,EAAU7B,EAAIT,KAAKwC,KAAI,SAAC/B,GAC9B,MAAO,CAAEzB,MAAOyB,EAAIgC,YAAa1C,MAAOU,EAAIX,YAIlDqC,EAASG,MAdTH,EAAS,KAyIOO,cAtJM,SAAC1D,GACzBH,EAASG,IAsJS2D,SAlJC,SAAC3D,GACpBD,EAAiBC,IAkJC4D,YAAY,6EACZC,MAAO,SAACA,GAAD,mBAAC,eACHA,GADE,IAELC,OAAO,2BACFD,EAAMC,QADL,IAEJC,UAAW,oBAUvB,yBAAKrB,UAAU,cACb,yBAAKA,UAAU,OACb,yBAAKA,UAAU,UACb,kBAAC,IAAD,CACEA,WACoB,IAAlBxC,EAAMD,QACF,0BACA,eAEN2D,YAAY,4EACZI,KAAK,cACLC,SAAU,KACVjE,MAAOE,EAAMF,MACb2D,SAAU,SAACpD,GAAD,OAAOJ,EAAS,CAAEH,MAAOO,EAAE2D,OAAOlE,aAKlD,yBAAK0C,UAAU,OACb,yBAAKA,UAAU,WACM,IAAlBxC,EAAMD,QACL,0BAAMY,GAAG,YAAY6B,UAAU,eAA/B,6HAIA,MAKR,yBAAKA,UAAU,cACb,yBAAKA,UAAU,OACb,yBAAKA,UAAU,UACb,kBAAC,IAAD,CACEsB,KAAK,oBACLC,SAAU,KACVvB,WACkB,IAAhBtC,EAAIH,QACA,0BACA,eAEN2D,YAAY,gHACZ5D,MAAOI,EAAIJ,MACX2D,SAAU,SAACpD,GAAD,OAAOF,EAAO,CAAEL,MAAOO,EAAE2D,OAAOlE,aAIhD,yBAAK0C,UAAU,OACb,yBAAKA,UAAU,WACI,IAAhBtC,EAAIH,QACH,0BAAMY,GAAG,YAAY6B,UAAU,eAA/B,iKAIA,MAKR,yBAAKA,UAAU,OACb,yBAAKA,UAAU,UACb,4BACEyB,KAAK,SACLzB,UAAU,yBACV0B,SACoB,OAAlBtE,GAAoC,KAAVI,GAAwB,KAARE,GAJ9C,6DAcN,uBAAGsC,UAAU,gBAAgB2B,MAAO,CAAEC,UAAW,KAC/C,kFADF,IACsBC,EAAYC,cCxQ/BlF,a,+GCCMG,E,mGAIjB,QADcgF,KAAKC,a,+BAIZ1D,GACP,IACM2D,EAAMC,IAAK5D,EADF,UAGf6D,aAAaC,QAAQ,WAAYH,K,iCAIjC,OAAOE,aAAaE,QAAQ,c,mCAI5B,OAAOC,YAAOP,KAAKC,gB","file":"static/js/12.c41be3d0.chunk.js","sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport Swal from \"sweetalert2\";\nimport { Link } from \"react-router-dom\";\nimport InputMask from \"react-input-mask\";\nimport { useDispatch } from \"react-redux\";\nimport AuthService from \"../../../managers/AuthService\";\nimport AsyncSelect from \"react-select/async\";\n\nimport packageJson from \"../../../../package.json\";\n\n// Api\nimport { showUser } from \"../../../reduxs/actions/ScanUser\";\nimport { createRegister } from \"../../../reduxs/actions/ScanRegister\";\n\nfunction Register(props) {\n  const Auth = new AuthService(\"http://localhost:3000/\");\n  const dispatch = useDispatch();\n  const [inputValue, setValue] = useState(\"\");\n  const [selectedValue, setSelectedValue] = useState(null);\n  const [phone, setPhone] = useState({ value: \"\", isValid: true });\n  const [cid, setCid] = useState({ value: \"\", isValid: true });\n\n  // handle input change event\n  const handleInputChange = (value) => {\n    setValue(value);\n  };\n\n  // handle selection\n  const handleChange = (value) => {\n    setSelectedValue(value);\n  };\n\n  // load options using API call\n  const loadOptions = (inputValue, callback) => {\n    if (inputValue == null || inputValue.length < 3) {\n      // not executing with less than 3 characters\n      callback([]);\n      return;\n    }\n\n    // load options in select\n    return dispatch(showUser(inputValue)).then((response) => {\n      let workers = [];\n      if (response && !response.error) {\n        response.map((res) => {\n          return (workers = res.data.map((res) => {\n            return { value: res.badgenumber, label: res.name };\n          }));\n        });\n      }\n      callback(workers);\n    });\n  };\n\n  const formIsValidSearch = () => {\n    let isGood = true;\n\n    if (phone.value.length < 11) {\n      phone.isValid = false;\n      isGood = false;\n    }\n\n    if (cid.value.length < 17) {\n      cid.isValid = false;\n      isGood = false;\n    }\n\n    if (!isGood) {\n      setPhone({\n        ...phone\n      });\n      setCid({\n        ...cid\n      });\n    }\n    return isGood;\n  };\n\n  const handleSubmit = (e) => {\n    e.preventDefault();\n    if (formIsValidSearch()) {\n      const data_token = {\n        id: selectedValue.value,\n        name: selectedValue.label,\n        phone: phone.value\n      };\n\n      const data = {\n        userid: selectedValue.value,\n        name: selectedValue.label,\n        phone: phone.value,\n        cid: cid.value\n      };\n\n      let Create = new Promise(function (resolve, reject) {\n        async function createRegisterMsg() {\n          return await dispatch(createRegister(data)).then((res) => {\n            return res[0].msg;\n          });\n        }\n        // get result by function\n        (async function () {\n          let resRegister = await createRegisterMsg();\n\n          if (resRegister === \"created successful\") {\n            Auth.setToken(data_token);\n            setTimeout(() => {\n              window.location.replace(\"/rehscan/#/scan/member-list\");\n            }, 1600);\n            resolve(true);\n          } else {\n            reject(false);\n          }\n        })();\n      });\n\n      // promiss status and msg\n      Create.then((status) => {\n        status\n          ? Swal.fire({\n              // position: \"top-center\",\n              icon: \"success\",\n              title: \"สำเร็จ\",\n              text: \"จำกัดการลงทะเบียน 1 คนแต่ 1 เครื่อง\",\n              showConfirmButton: false,\n              timer: 1500\n            })\n          : Swal.fire({\n              // position: \"top-center\",\n              icon: \"warning\",\n              title: \"ผิดพลาด\",\n              text: \"ลงทะเบียนผิดพลาด\",\n              showConfirmButton: false,\n              timer: 1500\n            });\n      }).catch((e) => {\n        Swal.fire({\n          // position: \"top-center\",\n          icon: \"error\",\n          title: \"ผิดพลาด\",\n          text: \"ลงทะเบียนผิดพลาด\",\n          showConfirmButton: false,\n          timer: 1500\n        });\n      });\n    }\n  };\n\n  useEffect(() => {}, [dispatch]);\n\n  return (\n    <div className=\"hold-transition login-page\">\n      <div className=\"login-box\">\n        <div className=\"login-logo\">\n          <Link to=\"/login\" replace>\n            <b>รพ. </b>ร้อยเอ็ด\n          </Link>\n        </div>\n        <div className=\"card\">\n          <div className=\"card-body login-card-body\">\n            <p className=\"login-box-msg\">ลงทะเบียนผู้สแกนใหม่</p>\n            <form className=\"mb-5\" onSubmit={(e) => handleSubmit(e)}>\n              <div className=\"form-group\">\n                <div className=\"row\">\n                  <div className=\"col-12\">\n                    <AsyncSelect\n                      cacheOptions\n                      defaultOptions\n                      value={selectedValue}\n                      getOptionLabel={(e) => e.label}\n                      getOptionValue={(e) => e.value}\n                      loadOptions={loadOptions}\n                      // options={options}\n                      onInputChange={handleInputChange}\n                      onChange={handleChange}\n                      placeholder=\"กรอก ชื่อ-สกุล\"\n                      theme={(theme) => ({\n                        ...theme,\n                        colors: {\n                          ...theme.colors,\n                          neutral50: \"#ced4da\" // Placeholder color\n                        }\n                      })}\n                    />\n                  </div>\n                </div>\n              </div>\n              {/* <pre>\n                Selected Value: {JSON.stringify(selectedValue || {}, null, 2)}\n              </pre> */}\n              <div className=\"form-group\">\n                <div className=\"row\">\n                  <div className=\"col-12\">\n                    <InputMask\n                      className={\n                        phone.isValid === false\n                          ? \"form-control is-invalid\"\n                          : \"form-control\"\n                      }\n                      placeholder=\"กรอก เบอร์โทร\"\n                      mask=\"999-9999999\"\n                      maskChar={null}\n                      value={phone.value}\n                      onChange={(e) => setPhone({ value: e.target.value })}\n                    />\n                  </div>\n                </div>\n\n                <div className=\"row\">\n                  <div className=\"col-12\">\n                    {phone.isValid === false ? (\n                      <span id=\"tel-error\" className=\"text-danger\">\n                        กรุณาตรวจสอบ เบอร์โทร\n                      </span>\n                    ) : (\n                      \"\"\n                    )}\n                  </div>\n                </div>\n              </div>\n              <div className=\"form-group\">\n                <div className=\"row\">\n                  <div className=\"col-12\">\n                    <InputMask\n                      mask=\"9-9999-99999-99-9\"\n                      maskChar={null}\n                      className={\n                        cid.isValid === false\n                          ? \"form-control is-invalid\"\n                          : \"form-control\"\n                      }\n                      placeholder=\"กรอก เลขบัตรประชาชน\"\n                      value={cid.value}\n                      onChange={(e) => setCid({ value: e.target.value })}\n                    />\n                  </div>\n                </div>\n                <div className=\"row\">\n                  <div className=\"col-12\">\n                    {cid.isValid === false ? (\n                      <span id=\"tel-error\" className=\"text-danger\">\n                        กรุณาตรวจสอบ เลขบัตรประชาชน\n                      </span>\n                    ) : (\n                      \"\"\n                    )}\n                  </div>\n                </div>\n              </div>\n              <div className=\"row\">\n                <div className=\"col-12\">\n                  <button\n                    type=\"submit\"\n                    className=\"btn btn-info btn-block\"\n                    disabled={\n                      selectedValue === null || phone === \"\" || cid === \"\"\n                        ? true\n                        : false\n                    }\n                  >\n                    ลงทะเบียน\n                  </button>\n                </div>\n              </div>\n            </form>\n            <p className=\"login-box-msg\" style={{ marginTop: 20 }}>\n              <b>เวอร์ชัน : </b> {packageJson.version}\n            </p>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default Register;\n","import Register from \"./Register\";\n\nexport default Register;\n","import decode from \"jwt-decode\";\nimport sign from \"jwt-encode\";\n\nexport default class AuthService {\n  loggedIn() {\n    // Checks if there is a saved token and it's still valid\n    const token = this.getToken(); // GEtting token from localstorage\n    return !!token; // handwaiving here\n  }\n\n  setToken(data) {\n    const secret = \"secret\";\n    const jwt = sign(data, secret);\n    // Saves user token to localStorage\n    localStorage.setItem(\"id_token\", jwt);\n  }\n  getToken() {\n    // Retrieves the user token from localStorage\n    return localStorage.getItem(\"id_token\");\n  }\n  getProfile() {\n    // Using jwt-decode npm package to decode the token\n    return decode(this.getToken());\n  }\n}\n"],"sourceRoot":""}